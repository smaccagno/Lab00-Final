<template>
    <!-- ① – PICKER Programma (visibile solo se più di un programma) -->
    <template if:true={showProgramPicker}>
        <lightning-card title="Seleziona Programma">
            <div class="slds-p-horizontal_small slds-p-vertical_small">
                <lightning-combobox
                    name="programSelector"
                    label="Programma"
                    value={programId}
                    options={programOptions}
                    onchange={handleProgramChange}>
                </lightning-combobox>
            </div>
        </lightning-card>
    </template>

    <!-- ② – TABELLA Budget + totali (identica a prima) -->
    <lightning-card title={cardTitle}>
        <lightning-button
            slot="actions"
            label="Aggiorna"
            title="Aggiorna"
            icon-name="utility:refresh"
            onclick={handleRefreshClick}
            disabled={isRefreshing}>
        </lightning-button>
        <template if:true={isRefreshing}>
            <div class="slds-p-around_small">
                <lightning-spinner alternative-text="Aggiornamento" size="small"></lightning-spinner>
            </div>
        </template>
        <lightning-datatable
            key-field="Id"
            data={relatedData}
            columns={columns}
            hide-checkbox-column="true"
            default-sort-direction={sortDirection}
            sorted-direction={sortDirection}
            sorted-by={sortedBy}
            onsort={onHandleSort}
            wrap-table-header="all">
        </lightning-datatable>

        <!-- Totali ri-utilizzati come prima -->
        <template if:true={showTotals}>
            <hr class="slds-m-top_medium slds-m-bottom_medium"/>
            <div class="slds-p-horizontal_small slds-p-bottom_small">
                <h3 class="slds-text-heading_small slds-m-bottom_small">
                    Vista Totale del tuo Budget
                </h3>

                <div class="slds-grid">
                    <div class="slds-size_1-of-2">
                        <template for:each={totalsLeft} for:item="tot">
                            <div key={tot.fieldName} class="slds-p-vertical_xx-small">
                                <strong>{tot.label}:</strong> {tot.formatted}
                            </div>
                        </template>
                    </div>
                    <div class="slds-size_1-of-2">
                        <template for:each={totalsRight} for:item="tot">
                            <div key={tot.fieldName} class="slds-p-vertical_xx-small">
                                <strong>{tot.label}:</strong> {tot.formatted}
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </template>
    </lightning-card>
</template>